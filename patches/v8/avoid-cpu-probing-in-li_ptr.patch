From f5469ae2293603ae32813f43d75ce70a7f23ff46 Mon Sep 17 00:00:00 2001
From: Levi Zim <rsworktech@outlook.com>
Date: Mon, 10 Jun 2024 10:06:27 +0800
Subject: [PATCH] avoid cpu probing in li_ptr

CPU probing is an expensive thing to do and we should avoid doing it upon every li_ptr call.

Fixes performance regresion bisected in https://github.com/riscv-forks/electron/issues/1

Change-Id: Ib5ff89b2a730e08de6735123ae60adeffe811ed8
---
 AUTHORS                              | 1 +
 src/codegen/riscv/assembler-riscv.cc | 1 -
 2 files changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/codegen/riscv/assembler-riscv.cc b/src/codegen/riscv/assembler-riscv.cc
index fa05592ea58..484d6813cbb 100644
--- a/src/codegen/riscv/assembler-riscv.cc
+++ b/src/codegen/riscv/assembler-riscv.cc
@@ -1069,7 +1069,6 @@ void Assembler::GeneralLi(Register rd, int64_t imm) {
 }
 
 void Assembler::li_ptr(Register rd, int64_t imm) {
-  base::CPU cpu;
   // Initialize rd with an address
   // Pointers are 48 bits
   // 6 fixed instructions are generated
-- 
2.39.2

